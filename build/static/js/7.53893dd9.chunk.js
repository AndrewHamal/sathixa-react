(this["webpackJsonpsathixa-react"]=this["webpackJsonpsathixa-react"]||[]).push([[7],{562:function(e,n,o){},699:function(e,n,o){"use strict";o.r(n),o.d(n,"default",(function(){return U}));var t=o(23),a=(o(506),o(56)),i=o(33),l=(o(562),o(0)),r=o(486),c=(o(521),o(522)),d=o(696),s=o(705),u=o(674),v=o(675),p=o(556),g=(o(586),o(40)),f=o(36),h=o(97),m=o(51),w=o(137),b=o(31),j=(o(280),o(173)),y=(o(587),o(1));delete r.Icon.Default.prototype._getIconUrl,r.Icon.Default.mergeOptions({iconRetinaUrl:"Map Marker_8.png",iconUrl:"Map Marker_8.png",iconSize:new r.Point(35,35),shadowUrl:""});var O=r.icon({iconRetinaUrl:"Truck_6 (1).png",iconUrl:"Truck_6 (1).png",iconSize:new r.Point(35,35),shadowUrl:""}),k=r.icon({iconRetinaUrl:"accurate.svg",iconUrl:"accurate.svg",iconSize:new r.Point(40,40),shadowUrl:""}),x=(r.icon({iconRetinaUrl:"Map Marker_6.png",iconUrl:"Map Marker_6.png",iconSize:new r.Point(35,35),shadowUrl:""}),r.divIcon({iconRetinaUrl:"car.png",iconUrl:"car.png",html:'<div class="rider-icon" ><img src="/car.png" width="45"></>'})),L=function(e){var n,o,L=Object(l.useRef)(),S=Object(l.useState)(),_=Object(t.a)(S,2),P=(_[0],_[1]),U=Object(b.g)(),z=new URLSearchParams(U.location.search),T=null===z||void 0===z?void 0:z.get("from"),E=Object(l.useState)(!0),M=Object(t.a)(E,2),R=(M[0],M[1]),G=null===z||void 0===z?void 0:z.get("rider"),W=Object(l.useState)(),C=Object(t.a)(W,2),q=C[0],I=C[1],N=Object(f.c)(m.d),D=Object(f.b)(),V=Object(f.c)(m.f),Z=Object(f.c)(m.g),J="",A="",B={broadcaster:"pusher",key:"f1420c508647e4f94ca3",cluster:"ap2",wsHost:"socket.sathichha.com",wsPort:443,forceTLS:!0,disableStats:!0,enabledTransports:["ws","wss"]};Object(l.useEffect)((function(){var e=U.listen((function(){"undefined"!==typeof window.echo&&(window.echo.leave("vendorPackage."+G),delete window.echo,delete window.rider)}));return function(){e()}}),[U,G]),Object(l.useEffect)((function(){var e=L.current,n=(void 0===e?{}:e).leafletElement;if(null!==G){Object(h.d)(G).then((function(e){var o,t,a,i,l,c,d,s,u,v,p,g,f,h,m,w,b,y,O,k;(null===(o=e=e.data)||void 0===o||null===(t=o.location)||void 0===t?void 0:t.lat)==(null===(a=e)||void 0===a||null===(i=a.vendor)||void 0===i||null===(l=i.location)||void 0===l?void 0:l.lat)&&(null===(c=e)||void 0===c||null===(d=c.location)||void 0===d?void 0:d.long)==(null===(s=e)||void 0===s||null===(u=s.vendor)||void 0===u||null===(v=u.location)||void 0===v?void 0:v.long)||(r.Routing.control({waypoints:[r.latLng(null===(p=e)||void 0===p||null===(g=p.location)||void 0===g?void 0:g.lat,null===(f=e)||void 0===f||null===(h=f.location)||void 0===h?void 0:h.long),r.latLng(null===(m=e)||void 0===m||null===(w=m.vendor)||void 0===w||null===(b=w.location)||void 0===b?void 0:b.lat,null===(y=e)||void 0===y||null===(O=y.vendor)||void 0===O||null===(k=O.location)||void 0===k?void 0:k.long)],useZoomParameter:!0,pointMarkerStyle:{display:"none"},draggableWaypoints:!1,summaryTemplate:function(e){null===e||void 0===e||e.distance,null===e||void 0===e||e.time}}).addTo(n),null!==G&&(window.echo=new j.a(B),window.echo.connector.pusher.config.authEndpoint="https://api.sathichha.com/broadcasting/auth",window.echo.channel("vendorPackage."+G).listen(".location",(function(e){setTimeout((function(){if((null===e||void 0===e?void 0:e.package_id)==G){var n,o=L.current,t=(void 0===o?{}:o).leafletElement;window.rider?(null===t||void 0===t||t.setView([e.lat,e.long]),null===(n=window.rider)||void 0===n||n.setLatLng([e.lat,e.long])):(null===t||void 0===t||t.setView([e.lat,e.long]),window.rider=r.marker([e.lat,e.long],{draggable:!1,icon:x,zoom:14}).addTo(t),document.querySelector(".rider-icon img").style.transform="rotate(".concat(e.heading||0,"deg)"))}}),400)}))));R(!1)}));var o=new j.a(B);return function(){o.leave("vendorPackage."+G)}}R(!1)}),[]),Object(l.useEffect)((function(){var n=!0;return e.refresh>0&&n&&H(),function(){n=!1}}),[e.refresh]),Object(l.useEffect)((function(){var o=!0;return e.clearGeoWatch>0&&o&&navigator.geolocation.clearWatch(n),function(){o=!1}}),[e.clearGeoWatch]);var H=function(){var e=L.current,t=void 0===e?{}:e,a=t.leafletElement;"undefined"!==typeof a&&(o=(new r.LayerGroup).addTo(a),n=navigator.geolocation.watchPosition((function(e){J=e.coords.latitude,A=e.coords.longitude,a&&(a.setView([J,A+5e-4]),o.clearLayers(),window.current?window.current.setLatLng([J,A]):window.current=r.marker([J,A+5e-4],{icon:k,draggable:!1}).addTo(a),window.marker?window.marker.setLatLng([J,A]).bindPopup("Drag for location change."):(window.marker=r.marker([J,A],{draggable:!0,zoom:14}).addTo(a).bindPopup("Drag for location change.").openPopup(),c.reverseGeocode({lat:J,lon:A,addressdetails:!0,"accept-language":"np",zoom:18}).then((function(e){var n={city:e.address.suburb||e.address.town||e.address.city,state:e.address.region||e.address.county,country:e.address.country,long:e.lon,lat:e.lat,whole_address:e.display_name};document.querySelector(".search-input").value=e.display_name,I(n),F(),document.querySelector(".search-input").value=e.display_name})),F()))})))};Object(l.useEffect)((function(){var e=!0;return 0===N.length&&e&&Object(h.c)().then((function(e){D(Object(m.h)(e.data))})),function(){e=!1}}),[]),Object(l.useEffect)((function(){var e,n=!0;if((0===Z.length&&n&&null===G&&Object(w.b)().then((function(e){if(200===e.status){if(null===e.data.location)return void H(!0);var n,o;D(Object(m.l)(e.data)),document.querySelector(".search-input").value=null===(n=e.data)||void 0===n||null===(o=n.location)||void 0===o?void 0:o.whole_address}})),"undefined"!==typeof Z&&null!==Z.location&&0!==Z.length&&n)&&"undefined"!==typeof(null===Z||void 0===Z||null===(e=Z.location)||void 0===e?void 0:e.lat)){var o,t,a,i,l,c,d=L.current,s=(void 0===d?{}:d).leafletElement;if((new r.LayerGroup).addTo(s).clearLayers(),null===G)window.marker=r.marker([null===Z||void 0===Z||null===(a=Z.location)||void 0===a?void 0:a.lat,null===Z||void 0===Z||null===(i=Z.location)||void 0===i?void 0:i.long],{draggable:!0}).addTo(s).bindPopup("Drag to change location").openPopup();else window.marker=r.marker([null===Z||void 0===Z||null===(l=Z.location)||void 0===l?void 0:l.lat,null===Z||void 0===Z||null===(c=Z.location)||void 0===c?void 0:c.long],{draggable:!0}).addTo(s);s.setView([null===Z||void 0===Z||null===(o=Z.location)||void 0===o?void 0:o.lat,null===Z||void 0===Z||null===(t=Z.location)||void 0===t?void 0:t.long]),F()}return function(){n=!1}}),[Z]);var F=function(){window.marker.on("dragend",(function(e){var n,o;c.reverseGeocode({lat:null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n._latlng.lat,lon:null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o._latlng.lng,addressdetails:!0,"accept-language":"np",zoom:18}).then((function(n){var o;window.marker.setLatLng(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o._latlng);var t={city:n.address.suburb||n.address.town||n.address.city,state:n.address.region||n.address.county,country:n.address.country,long:n.lon,lat:n.lat,whole_address:n.display_name};P(n.display_name),document.querySelector(".search-input").value=n.display_name,I(t)}))}))};return Object(y.jsxs)("div",{className:"map-container",children:[Object(y.jsxs)(d.a,{center:[27.7081859,85.322004],minZoom:"6",maxZoom:"18",zoom:"15",keyboard:!0,doubleClickZoom:!0,scrollWheelZoom:!0,ref:L,id:"map",children:[Object(y.jsx)(s.a,{url:"https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),null===N||void 0===N?void 0:N.map((function(e,n){return Object(y.jsx)(u.a,{position:[e.location.lat,e.location.long],icon:O,children:Object(y.jsxs)(v.a,{sticky:!0,offset:[0,-15.2],direction:"top",opacity:1,children:[Object(y.jsx)("p",{className:"font-weight-bold",children:"Sathixa Vendor"}),Object(y.jsx)("p",{children:e.first_name+" "+e.last_name})]})},n)})),null===G?Object(y.jsx)(p.a,{onChange:function(e){var n=L.current,o=(void 0===n?{}:n).leafletElement,t=(new r.LayerGroup).addTo(o);t.clearLayers(),c.reverseGeocode({lat:e.latLng.lat,lon:e.latLng.lng,addressdetails:!0,"accept-language":"np",zoom:18}).then((function(n){t.clearLayers(),window.marker.setLatLng(e.latLng);var o={city:n.address.suburb||n.address.town||n.address.city,state:n.address.region||n.address.county,country:n.address.country,long:n.lon,lat:n.lat,whole_address:n.display_name};document.querySelector(".search-input").value=n.display_name,I(o),F()}))},position:"topleft",inputPlaceholder:"Search",showMarker:!1,zoom:14,closeResultsOnClick:!0,openSearchOnLoad:!0,providerOptions:{region:"np"}}):null]}),null===G?Object(y.jsx)(g.a,{type:"primary",onClick:function(){"undefined"!==typeof q?T?(D(Object(m.j)(Object(i.a)(Object(i.a)({},V),{},{value:Object(i.a)(Object(i.a)({},V.value),{},Object(a.a)({},"receiver_address",q))}))),U.push("/package-form")):Object(h.m)(q).then((function(e){navigator.geolocation.clearWatch(n),g.i.success("Location updated !!!",2),D(Object(m.l)(e.data.data)),U.push("/dashboard")})).catch((function(e){g.i.fail("Someting went wrong",2)})):g.i.fail("Location is not selected",2)},className:"px-4 text-white position-absolute text-uppercase",style:{zIndex:"9999999",right:"14px",left:"14px",bottom:"20px",fontWeight:"400",letterSpacing:".5px",fontSize:"16px"},children:"Confirm Address"}):null]})},S=o(478),_=o(703),P=o(171);function U(){var e=Object(b.g)(),n=Object(l.useState)(0),o=Object(t.a)(n,2),a=o[0],i=o[1],r=Object(l.useState)(0),c=Object(t.a)(r,2),d=c[0],s=(c[1],new URLSearchParams(e.location.search)),u=null===s||void 0===s?void 0:s.get("from"),v=null===s||void 0===s?void 0:s.get("rider"),p=P.a.Content;return Object(y.jsxs)(P.a,{children:[Object(y.jsx)(S.a,{style:{position:"fixed",zIndex:1,width:"100%"},className:"site-page-header bg-red ",onBack:function(){return u?e.push("package-form"):e.push("dashboard")},title:"Location",extra:v?"":[Object(y.jsx)(_.a,{onClick:function(){i((function(e){return e+1}))},className:"my-auto text-white",style:{fontSize:"21px"}},0)]}),Object(y.jsx)(p,{className:"site-layout",style:{padding:"0",marginTop:53},children:Object(y.jsx)("div",{children:Object(y.jsx)(L,{refresh:a,clearGeoWatch:d})})})]})}}}]);
//# sourceMappingURL=7.53893dd9.chunk.js.map