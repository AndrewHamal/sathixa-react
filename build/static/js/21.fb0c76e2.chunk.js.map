{"version":3,"sources":["../node_modules/@ant-design/icons-svg/es/asn/SendOutlined.js","../node_modules/@ant-design/icons/es/icons/SendOutlined.js","pages/vendor/Chat.js"],"names":["SendOutlined","props","ref","React","AntdIcon","Object","assign","icon","SendOutlinedSvg","displayName","Content","Layout","Chat","history","useHistory","id","useParams","messagesEnd","useRef","useState","messages","setMessages","loader","setLoader","ticketInfo","setTicket","antIcon","style","fontSize","spin","send","setSend","options","broadcaster","process","key","cluster","wsHost","wsPort","forceTLS","disableStats","enabledTransports","authorizer","channel","authorize","socketId","callback","axios","method","url","headers","Authorization","localStorage","getItem","data","socket_id","channel_name","name","then","response","catch","error","echo","Echo","scrollToBottom","current","scrollIntoView","showMessage","ticketChat","res","useEffect","ticket","listen","event","className","padding","marginTop","active","position","zIndex","width","title","onBack","goBack","height","paddingTop","paddingBottom","message","status","ticket_file","length","map","i","src","alt","vendor_id","float","clear","indicator","onSubmit","e","preventDefault","formData","FormData","target","append","storeChatVendor","document","querySelector","value","reset","rows","placeholder","required","htmlType","type","shape"],"mappings":"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","file":"static/js/21.fb0c76e2.chunk.js","sourcesContent":["// This icon file is generated automatically.\nvar SendOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"defs\", \"attrs\": {}, \"children\": [{ \"tag\": \"style\", \"attrs\": {} }] }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z\" } }] }, \"name\": \"send\", \"theme\": \"outlined\" };\nexport default SendOutlined;\n","// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport SendOutlinedSvg from \"@ant-design/icons-svg/es/asn/SendOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar SendOutlined = function SendOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, Object.assign({}, props, {\n    ref: ref,\n    icon: SendOutlinedSvg\n  }));\n};\n\nSendOutlined.displayName = 'SendOutlined';\nexport default /*#__PURE__*/React.forwardRef(SendOutlined);","import { useHistory, useParams } from \"react-router-dom\";\nimport { useEffect, useRef, useState } from \"react\";\n\nimport { PageHeader, Skeleton } from \"antd\";\nimport { Layout } from \"antd\";\nimport { Button } from \"antd\";\nimport { SendOutlined } from \"@ant-design/icons\";\nimport { storeChatVendor } from \"@/api/vendor/index\"\nimport { ticket, ticketChat } from \"@/api/vendor/index\"\nimport Pusher from \"pusher-js\"\nimport Echo from 'laravel-echo';\nimport axios from \"axios\";\nimport '@/assets/css/ticketchat.css'\nimport { Spin } from 'antd';\nimport { LoadingOutlined } from '@ant-design/icons';\n\nconst { Content } = Layout;\n\nconst Chat = () => {\n  const history = useHistory();\n  const { id } = useParams();\n  let messagesEnd = useRef();\n  const [messages, setMessages] = useState(null);\n  const [loader, setLoader] = useState(true);\n  const [ticketInfo, setTicket] = useState(null);\n  const antIcon = <LoadingOutlined style={{ fontSize: 18}} spin />;\n  const [send, setSend] = useState(false)\n\n  let options = {\n    broadcaster: process.env.REACT_APP_BROADCAST,\n    key: process.env.REACT_APP_PUSHER_KEY,\n    cluster: 'ap2',\n    wsHost: 'socket.sathichha.com',\n    wsPort: 443,\n    forceTLS: true,\n    disableStats: true,\n    enabledTransports: [\"ws\", \"wss\"],\n    authorizer: (channel, options) => {\n        return {\n            authorize: (socketId, callback) => {\n                axios({\n                    method: \"POST\",\n                    url: `${process.env.REACT_APP_API_URL}api/vendor/broadcasting/auth`,\n                    headers: {\n                    Authorization: `Bearer ${localStorage.getItem('_token')}`,\n                    },\n                    data: {\n                    socket_id: socketId,\n                    channel_name: channel.name,\n                    },\n                })\n                    .then((response) => {\n                    callback(false, response.data);\n                    })\n                    .catch((error) => {\n                    callback(true, error);\n                });\n            }\n        }\n     }\n}\n\n  let echo = new Echo(options);\n\n  const scrollToBottom = () => {\n      messagesEnd.current.scrollIntoView();\n  }\n\n  const showMessage = () => {\n    ticketChat(id)\n    .then(res => {\n        setMessages(res.data)\n        setLoader(false)\n        scrollToBottom()\n    })\n  }\n\n  useEffect(() => {\n    ticket(id)\n    .then(res => {\n        setTicket(res?.data)\n        showMessage()\n    })\n\n    echo.channel(`ticket.${id}`)\n    .listen('.tickets', event => {\n      showMessage()\n      setSend(false)\n    })\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const sendMessage = (e) => {\n    e.preventDefault()\n    scrollToBottom()\n    setSend(true)\n\n    const formData = new FormData(e.target)\n    formData.append('ticket_id', id);    \n\n    storeChatVendor(id, formData)\n    .then(res => {\n      scrollToBottom()\n      document.querySelector('textarea').value = ''\n      document.querySelector('#form').reset()\n    })\n  }\n\n  if(loader) { return <Content\n    className=\"site-layout\"\n    style={{\n      padding: \"0 14px\",\n      marginTop: 60,\n    }}\n  > <Skeleton active/></Content> }\n\n  return (\n    <Layout>\n      <PageHeader\n        style={{ position: \"fixed\", zIndex: 1, width: \"100%\" }}\n        className=\"site-page-header bg-red \"\n        title=\"Ticket Message\"\n        onBack={() => history.goBack()}\n      />\n\n      <Content\n        className=\"site-layout\"\n        style={{\n          height:\"-webkit-fill-available!important\",\n          paddingTop: 54,\n          paddingBottom: 54,\n        }}\n      >\n        <div className=\"site-layout-background\">\n          <div className=\"chat-screen px-3\"\n            >\n            <div className=\"d-flex justify-content flex-column mt-3 mb-4 \">\n              <p className=\"font-14 font-weight-600 pt-2 text-center text-capitalize\">\n                  { ticketInfo?.message }\n              </p>\n              <p className=\"font-10 text-center\">Ticket status: {\n                    ticketInfo.status == 0 ? <span className=\"text-success\">Active</span> : <span className=\"text-danger\">Closed</span>\n                }</p>\n            </div>\n            { ticketInfo?.ticket_file?.length ?\n            <>\n            <p className=\"mb-2\">Attachments</p>\n            <div className=\"row\">\n    \n                {\n                    ticketInfo?.ticket_file?.map((res, i) => (\n                        // eslint-disable-next-line jsx-a11y/alt-text\n                        <div className=\"col-4 p-3 text-center bg-white\" key={i}>\n                            <img src={res.url} alt={'d'} className=\"img-fluid\"/>\n                        </div>\n                    ))\n                }\n            </div>\n            </>\n            :\" \"}\n\n            {\n                messages.map((res, i) => (\n                  <div key={i}>\n                    {\n                      res.vendor_id === null ?\n                      <div className={'send my-3 ml-auto'}>\n                          <p>{res.message}</p>\n                      </div>\n                      : <div className={'recieve my-3'}>\n                          <p>{res.message}</p>\n                      </div>\n                    }\n                  </div>\n                ))\n            }\n           { send ? <div style={{ float:\"left\", clear: \"both\" }}>\n              <Spin indicator={antIcon} />\n              </div> : ''\n            }\n\n            <div style={{ float:\"left\", clear: \"both\" }}\n                ref={messagesEnd}>\n            </div>\n          </div>\n          <div className=\"chat-bg position-fixed py-2 px-3\">\n            <form onSubmit={sendMessage} className=\"d-flex\" id=\"form\">\n                <textarea rows={1} name=\"message\" placeholder=\"Type your message here\" required/>\n                <Button\n                    htmlType=\"submit\"\n                    type=\"primary\"\n                    shape=\"circle\"\n                    icon={<SendOutlined />}\n                    className=\"ml-2 my-auto\"\n                />\n            </form>\n          </div>\n        </div>\n      </Content>\n    </Layout>\n  );\n};\n\nexport default Chat;\n"],"sourceRoot":""}